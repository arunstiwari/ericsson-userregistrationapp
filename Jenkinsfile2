def MAVEN_HOME
pipeline {
    agent { 
                label 'mac'
            }
    stages {
        
        stage('Build the Package') {
            agent { 
                label 'mac'
            }
            steps {
                sh '/usr/local/bin/mvn -DskipTests=true package'
            }
            
        }
        stage('Build the Docker Image') {
            agent { 
                label 'mac'
            }
            steps {
                sh '/usr/local/bin/docker build -t user-registration-application:1.0 .'
            }
        }
        stage('Launch the Docker Container') {
            agent { 
                label 'mac'
            }
            steps {
                sh '/usr/local/bin/docker run -d --name userregistrationapp -p 9080:9080 user-registration-application:1.0'
            }
        }
        stage('Checkout Acceptance Test') {
            agent { 
                label 'mac'
            }
            steps {
            	step(
            	  git url: 'https://github.com/arunstiwari/ericsson-acceptance-testing.git', branch: 'master'
            	)
            }
            post {
                always {
                    sh '/usr/local/bin/mvn test'
                }
            }
        }
        stage('Checkout Security Test') {
            agent { 
                label 'mac'
            }
            steps {
                sh '/usr/local/bin/git https://github.com/arunstiwari/ericsson-acceptance-testing.git'
            }
            post {
                always {
                    sh '/usr/local/bin/mvn br.com.softplan.security.zap:zap-maven-plugin:analyze'
                }
            }
        }
    }
}